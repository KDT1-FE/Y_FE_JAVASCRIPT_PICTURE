<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1433.0.min.js"></script>
    <link rel="stylesheet" href="/styles/general.css" />
    <link rel="stylesheet" href="/styles/theme.css" />
    <link rel="stylesheet" href="/styles/profile.css" />
    <link rel="stylesheet" href="/styles/header.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@200;300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <header class="header">
      <a id="header-title" href="/">TK MemberDB</a>
    </header>
    <main id="profile-main">
      <h1 class="title text-xl">
        <span id="member-name"></span>님의 프로필 정보
      </h1>
      <div class="manage-bar">
        <button id="manage-bar__edit-btn" class="bg-blue">수정</button>
        <button id="manage-bar__remove-btn" class="bg-pink">
          회원정보삭제
        </button>
      </div>
      <div class="profile bg-main150">
        <div class="profile__photo-box">
          <img id="profile-photo" />
        </div>
        <div class="profile__detail">
          <ul>
            <li class="profile__name"><span>이름 :</span></li>
            <li class="profile__email"><span>이메일 :</span></li>
            <li class="profile__phoneNum"><span>전화번호 :</span></li>
            <li class="profile__position"><span>포지션 :</span></li>
          </ul>
        </div>
      </div>

      <div id="modal">
        <form class="edit-form bg-main100">
          <div class="edit-form__container">
            <div class="edit-form__photoBox bg-gray">
              <img id="preview" />
              <label
                class="photo-input__label bg-main150 text-s"
                for="photo-input"
                >Change Image</label
              >
              <input id="photo-input" type="file" />
            </div>
            <div class="edit-form__inputBox">
              <label for="edit-name">이름</label>
              <input id="edit-name" />
              <label for="edit-email">이메일</label>
              <input id="edit-email" />
              <label for="edit-phoneNum">전화번호</label>
              <input id="edit-phoneNum" />
              <label for="edit-position">포지션</label>
              <input id="edit-position" />
              <button class="edit-form__submit bg-blue" type="submit">
                submit
              </button>
              <button class="edit-form__cancel bg-pink">cancel</button>
            </div>
          </div>
        </form>
      </div>
    </main>
    <script type="module" src="/js/config/aws.js"></script>
    <script type="module" src="/js/constant/profile.js"></script>
    <script type="module" src="/js/api/getProfile.js"></script>
    <script type="module" src="/js/api/editProfile.js"></script>
    <script type="module" src="/js/api/deleteProfile.js"></script>
    <script type="module">
      import { S3endpoint } from "/js/constant/aws.js";
      import { editProfile } from "/js/api/editProfile.js";
      import { deleteProfile } from "/js/api/deleteProfile.js";
      import {
        profile,
        deleteBtn,
        editForm,
        edit_photo,
        openEditorBtn,
        previewImg,
        submit,
        cancel,
      } from "/js/constant/profile.js"; // DOM객체 import

      let name = document.querySelector("#member-name");
      name.innerText = localStorage.getItem("profile");

      const modal = document.querySelector("#modal");

      // 수정창 프리뷰 기본 이미지 설정
      const key = localStorage.getItem("profile");
      previewImg.src = S3endpoint + "/" + key + "/profile_photo";

      // 이벤트
      openEditorBtn.addEventListener("click", openEdit);
      deleteBtn.addEventListener("click", deleteProfile);
      edit_photo.addEventListener("change", previewEditPhoto);
      cancel.addEventListener("click", closeEdit);
      submit.addEventListener("click", editProfile);

      function openEdit() {
        editForm.style.display = "block";
        modal.style.visibility = "visible";
      }

      function closeEdit(event) {
        event.preventDefault();
        modal.style.visibility = "hidden";
      }

      function previewEditPhoto() {
        const imageSrc = URL.createObjectURL(edit_photo.files[0]);
        previewImg.src = imageSrc;
      }
    </script>
  </body>
</html>
