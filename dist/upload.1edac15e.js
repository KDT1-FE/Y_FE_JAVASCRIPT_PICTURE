firebase.initializeApp({apiKey:"AIzaSyDBWZgf69JelbmqlPPPzj56W5yFL-Q5wZo",authDomain:"project-1-8debf.firebaseapp.com",projectId:"project-1-8debf",storageBucket:"project-1-8debf.appspot.com",messagingSenderId:"386056815137",appId:"1:386056815137:web:92425cb061808073ed9960"});const e=firebase.firestore(),t=firebase.storage();let a="",r="";const n=e.collection("profile"),l=document.querySelector(".btn-submit"),o=document.querySelector("form"),d=document.querySelector(".btn-cancel"),i=document.querySelector(".input-file"),c=document.querySelector(".input-rank"),s=document.querySelector(".input-name"),u=document.querySelector(".input-email"),b=document.querySelector(".input-self"),m=document.querySelector(".btn-modify"),f=document.querySelector(".btn-delete"),p=document.querySelector(".image"),[v,y]=location.search.split("=");function h(){let e=i.files[0],a=t.ref(),o=a.child("image/"+new Date().getTime()),d=o.put(e);if(y&&!i.value){let e={rank:c.value,name:s.value,email:u.value,self:b.value};w(e)}y&&i.value?d.on("state_changed",null,e=>{console.error("실패 사유는",e)},()=>{d.snapshot.ref.getDownloadURL().then(e=>{let t={rank:c.value,name:s.value,photo:e,email:u.value,self:b.value};w(t,g(r))})}):d.on("state_changed",null,e=>{console.error("실패 사유는",e)},()=>{d.snapshot.ref.getDownloadURL().then(e=>{let t={id:new Date().getTime(),rank:c.value,name:s.value,photo:e,email:u.value,self:b.value};!function(e){n.add(e).then(()=>{alert("프로필 등록이 완료되었습니다!"),k(),l.disabled="false"}).catch(e=>{console.log(e)})}(t)})})}function g(e){let a=t.refFromURL(e);return a.delete()}function k(){window.location.href="./index.html"}function w(e,t){l.disabled="true";let r=n.doc(a);r.update(e).then(()=>{alert("프로필이 변경되었습니다!"),k(),l.disabled="false"}).catch(e=>{console.error("Error updating document: ",e)})}async function A(e){try{await g(e);let t=await n.get(),a=t.docs.find(e=>e.data().id===Number(y));a?(await a.ref.delete(),alert("프로필 삭제가 완료되었습니다"),k()):console.error("문서를 찾을 수 없습니다")}catch(e){console.error(e)}}l.addEventListener("click",h),i.addEventListener("change",function(e){let t=e.target.files[0];if(t){let e=new FileReader;e.onload=e=>{p.setAttribute("src",e.target.result)},e.readAsDataURL(t)}}),d.addEventListener("click",k),m.addEventListener("click",function(){i.removeAttribute("disabled"),c.removeAttribute("disabled"),s.removeAttribute("disabled"),u.removeAttribute("disabled"),b.removeAttribute("disabled")}),document.addEventListener("DOMContentLoaded",async()=>{try{n.get().then(e=>{e.forEach(e=>{e.data().id===Number(y)&&(p.setAttribute("src",`${e.data().photo}`),i.value="",c.value=e.data().rank,s.value=e.data().name,u.value=e.data().email,b.value=e.data().self)})})}catch(e){console.error("문서를 가져오는 도중 오류가 발생했습니다",e)}}),window.addEventListener("keydown",e=>{"Enter"===e.key&&h()}),o.addEventListener("submit",e=>{e.preventDefault()}),i.addEventListener("click",()=>r=p.src),f.addEventListener("click",()=>{A(p.src)}),y?(i.setAttribute("disabled",""),c.setAttribute("disabled",""),s.setAttribute("disabled",""),u.setAttribute("disabled",""),b.setAttribute("disabled",""),m.style.display="block",f.style.display="block",n.get().then(e=>{e.forEach(e=>{if(e.data().id===Number(y))return a=e.id})}).catch(e=>{console.error("문서 불러오기 중 오류:",e)})):(m.style.display="none",f.style.display="none");
//# sourceMappingURL=upload.1edac15e.js.map
