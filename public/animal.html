<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>동물의 숲</title>

    <link rel="icon" href="./favicon.ico" />

    <!-- font awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- css -->
    <link rel="stylesheet" href="./css/reset.css" />
    <link rel="stylesheet" href="./css/main.css" />
    <link rel="stylesheet" href="./css/animal.css" />

    <!-- gsap -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"
      integrity="sha512-16esztaSRplJROstbIIdwX3N97V1+pZvV33ABoG1H2OyTttBxEGkTsoIVsiP1iaTtM8b3+hu2kB6pQ4Clr5yug=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollToPlugin.min.js"
      integrity="sha512-v/m68W+vaGN/6igoyFpd4GlQzu0jx9/n5gr2PKq5vif+RObyGKHse384YHrOULaxZ810XhlHUrmB3U8UnPB19Q=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <!--firebase 연결 -->
    <script src="/__/firebase/10.1.0/firebase-app-compat.js"></script>
    <script src="/__/firebase/10.1.0/firebase-auth-compat.js"></script>
    <script src="/__/firebase/10.1.0/firebase-firestore-compat.js"></script>
    <script src="/__/firebase/10.1.0/firebase-storage-compat.js"></script>

    <!-- jquery -->
    <script
      src="https://code.jquery.com/jquery-3.7.0.min.js"
      integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <!-- nav 바 -->
    <nav>
      <div class="navbar">
        <a href="index.html" class="navbar__logo">
          <img src="./img/동물의 숲.png" alt="동물의 숲" />
        </a>
        <ul class="navbar__menu">
          <li>
            <a href="#">
              <img src="./img/여울이_흰색.png" alt="주민 관리" />
              주민 관리</a
            >
          </li>
          <li>
            <a href="#">
              <img src="./img/달력_흰색.png" alt="달력" />
              일정</a
            >
          </li>
          <li>
            <a href="#">
              <img src="./img/섬관리_흰색.png" alt="섬 관리" />
              섬 관리</a
            >
          </li>
          <li>
            <a href="#">
              <img src="./img/미니게임_흰색.png" alt="미니게임" />
              미니 게임</a
            >
          </li>
        </ul>
        <div class="navbar__icons">
          <a href="#">
            <i class="fa-solid fa-gamepad"></i>
          </a>
        </div>

        <a href="#" class="navbar__toggle-btn">
          <i class="fa-solid fa-bars"></i>
        </a>
      </div>
    </nav>

    <!-- 주민 등록 -->
    <div class="animal-title">
      <div class="leaf">
        <img src="./img/동숲나뭇잎.png" alt="나뭇잎" />
        <div class="text">nintendo</div>
      </div>
      <div class="title__content">
        <img src="./img/여울이_노란색.png" alt="여울이" />
        <div class="text">주민 목록</div>
        <img src="./img/여울이_노란색.png" alt="여울이" />
      </div>
      <a href="./upload.html">
        <button>주민 등록하기</button>
      </a>
    </div>

    <!-- 주민 수정 폼 -->
    <div class="edit-form" style="display: none">
      <input id="edit-name" type="text" placeholder="이름" required />
      <input id="edit-birthday" type="text" placeholder="생일" required />
      <input id="edit-kind" type="text" placeholder="종족" required />
      <input id="edit-personality" type="text" placeholder="성격" required />
      <input id="edit-description" type="text" placeholder="정보" required />
      <button id="save-edit" data-doc-id="">저장</button>
    </div>

    <!-- 상단으로 -->
    <div id="to-top">
      <img src="./img/토용스크롤.png" alt="토용" />
    </div>

    <!-- 주민 상세 페이지 -->
    <!-- <div class="detailed-page">
      <div class="profile">
        <div class="text">Profile</div>
        <div class="edit-container">
          <div class="edit">edit</div>
          <div id="delete">delete</div>
        </div>
      </div>
      <div class="profile-content">
        <div class="detailed-page__photo">
          <img src="./img/너굴이.png" alt="" />
        </div>
        <div class="detailed-page__content">
          <div class="content-title">
            <img src="./img/동숲나뭇잎.png" alt="나뭇잎" />
            <div class="name">여울이</div>
          </div>
          <div class="content-info">
            <div class="birthday">12월 20일</div>
            <div class="kind">개(시츄)</div>
            <div class="personality">귀여움</div>
            <div class="debut">튀어나와요 동물의 숲</div>
            <div class="job">비서, 건축/설비</div>
            <div class="information">귀여운 댕댕스</div>
          </div>
        </div>
      </div>
    </div> -->

    <div class="container"></div>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyBR1m3u3HD0SUquyD5uvNFNzyWEwczphDo",
        authDomain: "animal-crossing-project.firebaseapp.com",
        projectId: "animal-crossing-project",
        storageBucket: "animal-crossing-project.appspot.com",
        messagingSenderId: "242406919285",
        appId: "1:242406919285:web:ac497cd3bdee770eecfc3c",
      };

      firebase.initializeApp(firebaseConfig);

      const db = firebase.firestore();

      // 삭제 함수 정의
      function deleteProduct(docId) {
        const confirmDelete = confirm("정말 삭제하시겠습니까?");
        if (confirmDelete) {
          db.collection("product")
            .doc(docId)
            .delete()
            .then(() => {
              window.location.href = "/animal.html";
            })
            .catch((error) => {
              console.error("Error deleting document: ", error);
            });
        } else {
          console.log("삭제가 취소되었습니다.");
        }
      }

      // 등록한 주민 목록
      db.collection("product")
        .get()
        .then((결과) => {
          결과.forEach((doc) => {
            console.log(doc);
            const 템플릿 = `
                  <div class="product">
                    <div class="product__image">
                      <div class="img" style="background-image: url(${
                        doc.data().이미지
                      })"></div>
                    </div>
                    <div class="product__info">
                      <div class="title">
                        <div class="name">${doc.data().이름}</div>
                        <div class="birthday">${doc.data().생일}</div>
                      </div>
                      <div class="kind">종족 |  ${doc.data().종족}</div>
                      <div class="personality">성격 |  ${doc.data().성격}</div>
                      <div class="description">정보 |  ${doc.data().정보}</div>
                    </div>
                    <div class="animal-crud">
                      <div class="animal-edit">edit</div>
                      <div id="delete" class="animal-delete" data-doc-id="${
                        doc.id
                      }" onclick="button_event();">delete</div>
                    </div>
                  </div>
                  `;
            $(".container").append(템플릿);

            //       템플릿.addEventListener("click", () => {});
            //     });
            //   });
          });

          // 삭제 버튼에 이벤트 리스너 설정
          $(".animal-delete").on("click", function () {
            const docId = $(this).data("doc-id");
            deleteProduct(docId);
          });
        });

      // 편집 버튼 클릭 이벤트 핸들러
      $(document).on("click", ".animal-edit", function () {
        const productEl = $(this).closest(".product");
        const docId = productEl.find(".animal-delete").data("doc-id");
        $("#save-edit").attr("data-doc-id", docId);
        console.log("docId:", docId);

        const editForm = $(".edit-form");
        const editName = editForm.find("#edit-name");
        const editBirthday = editForm.find("#edit-birthday");
        const editKind = editForm.find("#edit-kind");
        const editPersonality = editForm.find("#edit-personality");
        const editDescription = editForm.find("#edit-description");

        const productInfo = productEl.find(".product__info");
        const name = productInfo.find(".name").text();
        const birthday = productInfo.find(".birthday").text();
        const kind = productInfo.find(".kind").text().split(" | ")[1]; // "종족 | " 부분 제거
        const personality = productInfo
          .find(".personality")
          .text()
          .split(" | ")[1]; // "성격 | " 부분 제거
        const description = productInfo
          .find(".description")
          .text()
          .split(" | ")[1]; // "정보 | " 부분 제거

        // 편집 폼에 기존 정보 채우기
        editName.val(name);
        editBirthday.val(birthday);
        editKind.val(kind);
        editPersonality.val(personality);
        editDescription.val(description);

        // 편집 폼 보이기
        editForm.show();
      });

      // 저장 버튼 클릭 이벤트 핸들러
      $("#save-edit").on("click", function () {
        const docId = $(this).attr("data-doc-id");

        if (docId) {
          const editedData = {
            이름: $("#edit-name").val(),
            생일: $("#edit-birthday").val(),
            종족: $("#edit-kind").val(),
            성격: $("#edit-personality").val(),
            정보: $("#edit-description").val(),
          };

          db.collection("product")
            .doc(docId)
            .update(editedData)
            .then(() => {
              console.log("주민 정보가 수정되었습니다.");
              $(".edit-form").hide();

              // 해당 주민 정보 업데이트하기
              const productEl = $(
                `.product .animal-delete[data-doc-id="${docId}"]`
              ).closest(".product");
              const productInfo = productEl.find(".product__info");
              productInfo.find(".name").text(`${editedData.이름}`);
              productInfo.find(".birthday").text(`${editedData.생일}`);
              productInfo.find(".kind").text(`종족 | ${editedData.종족}`);
              productInfo
                .find(".personality")
                .text(`성격 | ${editedData.성격}`);
              productInfo
                .find(".description")
                .text(`정보 | ${editedData.정보}`);
            })
            .catch((error) => {
              console.error("주민 정보 수정 중 오류가 발생했습니다.", error);
            });
        } else {
          console.error("유효하지 않은 문서 ID입니다.");
        }
      });

      //클릭시 상단으로 이동
      const toTopEl = document.querySelector("#to-top");

      toTopEl.addEventListener("click", function () {
        gsap.to(window, 0.7, {
          scrollTo: 0,
        });
      });
    </script>
    <script defer src="./js/main.js"></script>
  </body>
</html>
